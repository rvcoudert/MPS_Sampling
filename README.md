# MPS-sampling Pipeline

## What is MPS-sampling Pipeline ?

MPS-sampling Pipeline is a GitLab project dedicated to compute statistics about ribosomal data and to sample huge sets of proteomes.
<br/>
The core of this project is based on SnakeMake.

###### What is SnakeMake ?

[SnakeMake](https://snakemake.readthedocs.io/en/stable/) is a tool created to manage workflow and data analysis in a transparence, reproducible and scalable way. Python-based, SnakeMake lies down on a master file called *SnakeFile* and encoding a directed acyclic graph (**DAG**). From the input to the output, the defined workflow is human-readable, could be run step-by-step and is deployable on any execution environment.

## What is the aim of the MPS-sampling Pipeline ?

Primarily, the MPS-sampling Pipeline was created to :
* understand huge ribosomal proteomes provided by RiboDB ;
* sample huge proteomes datasets in order to reconstruct phylogenetic trees on these huge datasets.

## What does the pipeline do ?

The MPS-sampling Pipeline sample huge proteomes datasets in several steps :
1. Run [MMseqs2-Linclust](https://github.com/soedinglab/MMseqs2/wiki/Tutorials) on the sequences of each protein.
2. Harmonise proteomic clustering and generate consensus genomic groups.
3. Pick a representative genome per genomic group.

While step 1 and 3 are relatively simple, the main difficulties are encountered during the step 2, decomposed in the following substeps :
1. Gather all proteomic clustering into a combination matrix.
2. Compute pre-connected components.
3. Compute connected components.
4. Compute final harmonisation on each connected component.

# How to

## How to install and set the MPS-sampling Pipeline ?

### 1) Install SnakeMake

SnakeMake installation method is available on the [official website](https://snakemake.readthedocs.io/en/stable/getting_started/installation.html). It needs to be installed through [Conda](https://docs.conda.io/projects/conda/en/latest/index.html) in a bash environment.

### 2) Set the Conda Environment

SnakeMake is using [Python](https://www.python.org/), [MMseqs2-Linclust](https://github.com/soedinglab/MMseqs2/wiki/Tutorials) and the LBBE R package [RiboPHYL](https://gitlab.in2p3.fr/ribodb/riboPHYL).
<br/>
While Python is natively pre-installed in Conda, you need to personnally install MMseq2-Linclust and RiboPHYL in the [Conda environment](https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html) dedicated to MPS-sampling Pipeline.

### 3) Set the Data

Typically, the MPS-sampling Pipeline take as input RiboDB export in a standard format. Currently, it consists on one directory per protein and four files in each directory with respective suffixes : "nuc_nonparalog.fst", "prot_nonparalog.fst", "nuc_paralog.fst", "prot_paralog.fst". At the moment, only the amino acid sequences are used, because it appears more suitable for the proteomic clustering through MMseqs2-LINCLUST, and the harmonisation only use the non-paralogous sequences, because it does not have decided yet how to handle paralogous sequences.

## How to launch the MPS-sampling Pipeline ?

Here is an example of a command line to launch the SnakeMake of the MPS-sampling Pipeline.
```
snakemake --cores all -s [SnakeFile_path] -d [data_path]
```

The argument `--cores all` indicates that all available cores can be used.
<br/>
The argument `-s [SnakeFile_path]` indicates the location of the SnakeFile.
<br/>
The `-d [data_path]` indicates the location of the data.

Thereby, a SnakeMake run is not dependant on the current location and could be called from anywhere.
<br/>
In the future, additional arguments can be added to customize the run, as the three parameters of MMseqs2-LINCLUST or the pre-connection / connection threshold.

## How to read the output generated by the MPS-sampling Pipeline ?

All the output generated by the MPS-sampling Pipeline are *csv* files and can be opened with any *csv* reader.
<br/>
For more ergonomy, the [RiboDB GUI](https://gitlab.in2p3.fr/ribodb/riboDB_gui) is another project dedicated to provide a R-based Shiny GUI to visualize and explore the outputs generated by the MPS-sampling Pipeline.

## Complete Details

Explain all the steps of the MPS-sampling Pipeline.
<br/>
TODO.
